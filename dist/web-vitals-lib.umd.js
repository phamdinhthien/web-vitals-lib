(function(h,p){typeof exports=="object"&&typeof module<"u"?p(exports):typeof define=="function"&&define.amd?define(["exports"],p):(h=typeof globalThis<"u"?globalThis:h||self,p(h.WebVitalsLib={}))})(this,function(h){"use strict";var p,y=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},S=function(e){if(document.readyState==="loading")return"loading";var t=y();if(t){if(e<t.domInteractive)return"loading";if(t.domContentLoadedEventStart===0||e<t.domContentLoadedEventStart)return"dom-interactive";if(t.domComplete===0||e<t.domComplete)return"dom-content-loaded"}return"complete"},Y=function(e){var t=e.nodeName;return e.nodeType===1?t.toLowerCase():t.toUpperCase().replace(/^#/,"")},I=function(e,t){var r="";try{for(;e&&e.nodeType!==9;){var n=e,i=n.id?"#"+n.id:Y(n)+(n.classList&&n.classList.value&&n.classList.value.trim()&&n.classList.value.trim().length?"."+n.classList.value.trim().replace(/\s+/g,"."):"");if(r.length+i.length>(t||100)-1)return r||i;if(r=r?i+">"+r:i,n.id)break;e=n.parentNode}}catch{}return r},B=-1,A=function(){return B},T=function(e){addEventListener("pageshow",function(t){t.persisted&&(B=t.timeStamp,e(t))},!0)},C=function(){var e=y();return e&&e.activationStart||0},d=function(e,t){var r=y(),n="navigate";return A()>=0?n="back-forward-cache":r&&(document.prerendering||C()>0?n="prerender":document.wasDiscarded?n="restore":r.type&&(n=r.type.replace(/_/g,"-"))),{name:e,value:t===void 0?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:n}},E=function(e,t,r){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var n=new PerformanceObserver(function(i){Promise.resolve().then(function(){t(i.getEntries())})});return n.observe(Object.assign({type:e,buffered:!0},r||{})),n}}catch{}},m=function(e,t,r,n){var i,o;return function(a){t.value>=0&&(a||n)&&((o=t.value-(i||0))||i===void 0)&&(i=t.value,t.delta=o,t.rating=function(u,c){return u>c[1]?"poor":u>c[0]?"needs-improvement":"good"}(t.value,r),e(t))}},P=function(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})},M=function(e){var t=function(r){r.type!=="pagehide"&&document.visibilityState!=="hidden"||e(r)};addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0)},R=function(e){var t=!1;return function(r){t||(e(r),t=!0)}},b=-1,k=function(){return document.visibilityState!=="hidden"||document.prerendering?1/0:0},L=function(e){document.visibilityState==="hidden"&&b>-1&&(b=e.type==="visibilitychange"?e.timeStamp:0,Z())},N=function(){addEventListener("visibilitychange",L,!0),addEventListener("prerenderingchange",L,!0)},Z=function(){removeEventListener("visibilitychange",L,!0),removeEventListener("prerenderingchange",L,!0)},D=function(){return b<0&&(b=k(),N(),T(function(){setTimeout(function(){b=k(),N()},0)})),{get firstHiddenTime(){return b}}},w=function(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()},j=[1800,3e3],q=function(e,t){t=t||{},w(function(){var r,n=D(),i=d("FCP"),o=E("paint",function(a){a.forEach(function(u){u.name==="first-contentful-paint"&&(o.disconnect(),u.startTime<n.firstHiddenTime&&(i.value=Math.max(u.startTime-C(),0),i.entries.push(u),r(!0)))})});o&&(r=m(e,i,j,t.reportAllChanges),T(function(a){i=d("FCP"),r=m(e,i,j,t.reportAllChanges),P(function(){i.value=performance.now()-a.timeStamp,r(!0)})}))})},H=[.1,.25],$=function(e,t){(function(r,n){n=n||{},q(R(function(){var i,o=d("CLS",0),a=0,u=[],c=function(s){s.forEach(function(l){if(!l.hadRecentInput){var v=u[0],F=u[u.length-1];a&&l.startTime-F.startTime<1e3&&l.startTime-v.startTime<5e3?(a+=l.value,u.push(l)):(a=l.value,u=[l])}}),a>o.value&&(o.value=a,o.entries=u,i())},f=E("layout-shift",c);f&&(i=m(r,o,H,n.reportAllChanges),M(function(){c(f.takeRecords()),i(!0)}),T(function(){a=0,o=d("CLS",0),i=m(r,o,H,n.reportAllChanges),P(function(){return i()})}),setTimeout(i,0))}))})(function(r){(function(n){if(n.entries.length){var i=n.entries.reduce(function(u,c){return u&&u.value>c.value?u:c});if(i&&i.sources&&i.sources.length){var o=(a=i.sources).find(function(u){return u.node&&u.node.nodeType===1})||a[0];if(o)return void(n.attribution={largestShiftTarget:I(o.node),largestShiftTime:i.startTime,largestShiftValue:i.value,largestShiftSource:o,largestShiftEntry:i,loadState:S(i.startTime)})}}var a;n.attribution={}})(r),e(r)},t)},ee=function(e,t){q(function(r){(function(n){if(n.entries.length){var i=y(),o=n.entries[n.entries.length-1];if(i){var a=i.activationStart||0,u=Math.max(0,i.responseStart-a);return void(n.attribution={timeToFirstByte:u,firstByteToFCP:n.value-u,loadState:S(n.entries[0].startTime),navigationEntry:i,fcpEntry:o})}}n.attribution={timeToFirstByte:0,firstByteToFCP:n.value,loadState:S(A())}})(r),e(r)},t)},J=0,O=1/0,x=0,te=function(e){e.forEach(function(t){t.interactionId&&(O=Math.min(O,t.interactionId),x=Math.max(x,t.interactionId),J=x?(x-O)/7+1:0)})},U=function(){return p?J:performance.interactionCount||0},ne=function(){"interactionCount"in performance||p||(p=E("event",te,{type:"event",buffered:!0,durationThreshold:0}))},z=[200,500],_=0,G=function(){return U()-_},g=[],V={},K=function(e){var t=g[g.length-1],r=V[e.interactionId];if(r||g.length<10||e.duration>t.latency){if(r)r.entries.push(e),r.latency=Math.max(r.latency,e.duration);else{var n={id:e.interactionId,latency:e.duration,entries:[e]};V[n.id]=n,g.push(n)}g.sort(function(i,o){return o.latency-i.latency}),g.splice(10).forEach(function(i){delete V[i.id]})}},ie=function(e,t){t=t||{},w(function(){var r;ne();var n,i=d("INP"),o=function(u){u.forEach(function(s){s.interactionId&&K(s),s.entryType==="first-input"&&!g.some(function(l){return l.entries.some(function(v){return s.duration===v.duration&&s.startTime===v.startTime})})&&K(s)});var c,f=(c=Math.min(g.length-1,Math.floor(G()/50)),g[c]);f&&f.latency!==i.value&&(i.value=f.latency,i.entries=f.entries,n())},a=E("event",o,{durationThreshold:(r=t.durationThreshold)!==null&&r!==void 0?r:40});n=m(e,i,z,t.reportAllChanges),a&&("PerformanceEventTiming"in window&&"interactionId"in PerformanceEventTiming.prototype&&a.observe({type:"first-input",buffered:!0}),M(function(){o(a.takeRecords()),i.value<0&&G()>0&&(i.value=0,i.entries=[]),n(!0)}),T(function(){g=[],_=U(),i=d("INP"),n=m(e,i,z,t.reportAllChanges)}))})},re=function(e,t){ie(function(r){(function(n){if(n.entries.length){var i=n.entries.sort(function(a,u){return u.duration-a.duration||u.processingEnd-u.processingStart-(a.processingEnd-a.processingStart)})[0],o=n.entries.find(function(a){return a.target});n.attribution={eventTarget:I(o&&o.target),eventType:i.name,eventTime:i.startTime,eventEntry:i,loadState:S(i.startTime)}}else n.attribution={}})(r),e(r)},t)},Q=[2500,4e3],W={},oe=function(e,t){(function(r,n){n=n||{},w(function(){var i,o=D(),a=d("LCP"),u=function(s){var l=s[s.length-1];l&&l.startTime<o.firstHiddenTime&&(a.value=Math.max(l.startTime-C(),0),a.entries=[l],i())},c=E("largest-contentful-paint",u);if(c){i=m(r,a,Q,n.reportAllChanges);var f=R(function(){W[a.id]||(u(c.takeRecords()),c.disconnect(),W[a.id]=!0,i(!0))});["keydown","click"].forEach(function(s){addEventListener(s,function(){return setTimeout(f,0)},!0)}),M(f),T(function(s){a=d("LCP"),i=m(r,a,Q,n.reportAllChanges),P(function(){a.value=performance.now()-s.timeStamp,W[a.id]=!0,i(!0)})})}})})(function(r){(function(n){if(n.entries.length){var i=y();if(i){var o=i.activationStart||0,a=n.entries[n.entries.length-1],u=a.url&&performance.getEntriesByType("resource").filter(function(F){return F.name===a.url})[0],c=Math.max(0,i.responseStart-o),f=Math.max(c,u?(u.requestStart||u.startTime)-o:0),s=Math.max(f,u?u.responseEnd-o:0),l=Math.max(s,a?a.startTime-o:0),v={element:I(a.element),timeToFirstByte:c,resourceLoadDelay:f-c,resourceLoadTime:s-f,elementRenderDelay:l-s,navigationEntry:i,lcpEntry:a};return a.url&&(v.url=a.url),u&&(v.lcpResourceEntry=u),void(n.attribution=v)}}n.attribution={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadTime:0,elementRenderDelay:n.value}})(r),e(r)},t)},X=[800,1800],ae=function e(t){document.prerendering?w(function(){return e(t)}):document.readyState!=="complete"?addEventListener("load",function(){return e(t)},!0):setTimeout(t,0)},ue=function(e,t){t=t||{};var r=d("TTFB"),n=m(e,r,X,t.reportAllChanges);ae(function(){var i=y();if(i){var o=i.responseStart;if(o<=0||o>performance.now())return;r.value=Math.max(o-C(),0),r.entries=[i],n(!0),T(function(){r=d("TTFB",0),(n=m(e,r,X,t.reportAllChanges))(!0)})}})},ce=function(e,t){ue(function(r){(function(n){if(n.entries.length){var i=n.entries[0],o=i.activationStart||0,a=Math.max(i.domainLookupStart-o,0),u=Math.max(i.connectStart-o,0),c=Math.max(i.requestStart-o,0);n.attribution={waitingTime:a,dnsTime:u-a,connectionTime:c-u,requestTime:n.value-c,navigationEntry:i}}else n.attribution={waitingTime:0,dnsTime:0,connectionTime:0,requestTime:0}})(r),e(r)},t)};function se(){const e=navigator.userAgent;return e.indexOf("Edg/")>-1||e.indexOf("Edge/")>-1?"Edge":e.indexOf("OPR/")>-1||e.indexOf("Opera")>-1?"Opera":e.indexOf("Chrome")>-1&&e.indexOf("Edg")===-1?"Chrome":e.indexOf("Safari")>-1&&e.indexOf("Chrome")===-1?"Safari":e.indexOf("Firefox")>-1?"Firefox":e.indexOf("MSIE")>-1||e.indexOf("Trident/")>-1?"Internet Explorer":"Unknown"}class le{constructor(t){this.config=t,this.apiEndpoint=t.apiEndpoint||"http://localhost:5000/api/collect"}send(t){if(!t||t.length===0)return;const r={metrics:t,browser:se()};this.config.debug&&console.log("[WebVitals] Sending metrics:",r);const n=new Blob([JSON.stringify(r)],{type:"application/json"});navigator.sendBeacon(this.apiEndpoint,n)||fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),keepalive:!0}).catch(o=>{this.config.debug&&console.error("[WebVitals] Failed to send metrics:",o)})}}function pe(e){return e}function fe(e){if(!e||!e.element)return null;try{let t={selector:e.element};return e.url&&(t.url=e.url),t}catch{return null}}function de(e){if(!e||!e.largestShiftTarget)return null;try{return{selector:e.largestShiftTarget}}catch{return null}}function me(e){if(!e||!e.eventTarget)return null;try{return{selector:e.eventTarget}}catch{return null}}class ge{constructor(t){this.reporter=t,this.metrics=[],addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.send()})}collect(t){const r={name:t.name,value:t.value,rating:t.rating,delta:t.delta,id:t.idm,page:window.location.href};if(t.attribution){if(t.name==="LCP"){const n=fe(t.attribution);n&&(r.element=n)}if(t.name==="CLS"){const n=de(t.attribution);n&&(r.element=n)}if(t.name==="INP"){const n=me(t.attribution);n&&(r.element=n)}}this.metrics.push(r)}send(){this.metrics.length!==0&&(this.reporter.send(this.metrics),this.metrics=[])}}function ve(e={}){const r={...{apiEndpoint:"http://localhost:5000/api/collect",debug:!1},...e},n=new le(r),i=new ge(n);return oe(o=>{r.debug&&console.log("[WebVitals] LCP:",o.value),i.collect(o)}),ee(o=>{r.debug&&console.log("[WebVitals] FCP:",o.value),i.collect(o)}),$(o=>{r.debug&&console.log("[WebVitals] CLS:",o.value),i.collect(o)},{reportAllChanges:!0}),ce(o=>{r.debug&&console.log("[WebVitals] TTFB:",o.value),i.collect(o)}),re(o=>{r.debug&&console.log("[WebVitals] INP interaction:",o.value),i.collect(o)},{reportAllChanges:!0}),r.debug&&console.log("[WebVitals] Initialized with config:",r),{batchCollector:i,reporter:n}}typeof window<"u"&&setTimeout(()=>{if(typeof window.onWebVitalsReady=="function")try{console.log&&console.log("[WebVitals] Library loaded, calling window.onWebVitalsReady()"),window.onWebVitalsReady()}catch(e){console.error("[WebVitals] Error in window.onWebVitalsReady callback:",e)}},0),h.initWebVitals=ve,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
